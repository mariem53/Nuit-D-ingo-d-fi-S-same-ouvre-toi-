<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscription - MECI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="./register-style.css">
</head>
<body>
    <!-- √âl√©ments flottants en arri√®re-plan -->
    <div class="floating-gaulois">ü™ì</div>
    <div class="floating-gaulois">üõ°Ô∏è</div>
    <div class="floating-gaulois">‚öîÔ∏è</div>
    <div class="floating-gaulois">üçó</div>
    
    <!-- Lucioles num√©riques -->
    <div class="fireflies" id="firefliesContainer"></div>
    
    <!-- Page d'inscription principale -->
    <div class="portal-container" id="signupPage">
        <!-- Porte du village -->
        <div class="village-gate">
            <h1 class="gate-title">REJOINS LA R√âSISTANCE !</h1>
            <p class="gate-subtitle">Inscris-toi au Village Num√©rique R√©sistant</p>
        </div>
        
        <!-- Forteresse d'inscription -->
        <div class="signup-fortress">
            <!-- Mur gaulois -->
            <div class="gaulish-wall">
                <div class="wall-shield">
                    <i class="fas fa-user-plus shield-icon"></i>
                </div>
                <div class="wall-message">
                    <p>"Par Toutatis ! Rejoins-nous pour combattre les g√©ants du num√©rique avec des logiciels libres et du mat√©riel reconditionn√© !"</p>
                </div>
            </div>
            
            <!-- Parchemin d'inscription -->
            <div class="scroll-form">
                <h2 class="form-title">Parchemin d'Enr√¥lement</h2>
                
                <form id="gaulishSignupForm">
                    <!-- Informations personnelles -->
                    <div class="form-group">
                        <label class="form-label">
                            <span class="label-icon">üë§</span>
                            Ton Nom de Gaulois
                        </label>
                        <input type="text" class="form-input" id="username" 
                               placeholder="Comment veux-tu qu'on t'appelle ?" required>
                        <div class="input-hint">Ex: Ast√©rix, Ob√©lix, Panoramix Num√©rix...</div>
                    </div>
                    
                    <!-- Email -->
                    <div class="form-group">
                        <label class="form-label">
                            <span class="label-icon">üì®</span>
                            Message des Pigeons Voyageurs
                        </label>
                        <input type="email" class="form-input" id="email" 
                               placeholder="O√π envoyer les messages secrets ?" required>
                        <div class="input-hint">Ton adresse √©lectronique</div>
                    </div>
                    
                    <!-- Mot de passe -->
                    <div class="form-group">
                        <label class="form-label">
                            <span class="label-icon">üîê</span>
                            Formule Magique Secr√®te
                        </label>
                        <input type="password" class="form-input" id="password" 
                               placeholder="Cr√©e une potion magique s√©curis√©e" required>
                        <div class="input-hint">Minimum 8 caract√®res avec majuscules, minuscules et chiffres</div>
                    </div>
                    
                    <!-- Confirmation mot de passe -->
                    <div class="form-group">
                        <label class="form-label">
                            <span class="label-icon">üîç</span>
                            Confirme ta Formule Magique
                        </label>
                        <input type="password" class="form-input" id="confirm_password" 
                               placeholder="R√©p√®te ta potion magique" required>
                    </div>
                    
                    <!-- Section Engagement -->
                    <div class="engagement-section">
                        <div class="engagement-title">
                            <i class="fas fa-handshake"></i>
                            Serment du R√©sistant
                        </div>
                        
                        <ul class="engagement-list">
                            <li>Je m'engage √† promouvoir les logiciels libres</li>
                            <li>Je lutterai contre l'obsolescence programm√©e</li>
                            <li>Je partagerai mes connaissances avec la communaut√©</li>
                            <li>Je respecterai les valeurs de NIRD : Inclusion, Responsabilit√©, Durabilit√©</li>
                        </ul>
                        
                        <div class="engagement-checkbox">
                            <input type="checkbox" id="acceptTerms" required>
                            <label for="acceptTerms">Je jure par Toutatis de respecter le serment du r√©sistant !</label>
                        </div>
                    </div>
                    
                    <!-- Bouton d'inscription -->
                    <button type="submit" class="signup-button" id="joinResistanceBtn">
                        <i class="fas fa-shield-alt"></i>
                        REJOINDRE LA R√âSISTANCE
                        <i class="fas fa-fist-raised"></i>
                    </button>
                </form>
                
                <!-- Lien vers connexion -->
                <div class="login-link">
                    D√©j√† un¬∑e r√©sistant¬∑e ? <a href="index.html">Connecte-toi ici</a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Page de succ√®s (cach√©e initialement) -->
    <div class="success-page" id="successPage">
        <div class="success-icon">üéâ</div>
        <h1 class="success-title">Bienvenue dans la R√©sistance !</h1>
        
        <div class="success-message">
            <p><strong>Par Toutatis, tu es officiellement enr√¥l√©¬∑e !</strong></p>
            <p>Ton nom de r√©sistant¬∑e : <strong id="resistantName"></strong></p>
            <p>Tu as maintenant acc√®s au Village Num√©rique R√©sistant et √† toutes ses ressources pour construire ensemble un avenir num√©rique libre, durable et responsable.</p>
        </div>
        
        <button class="success-button" onclick="window.location.href='/'">
            <i class="fas fa-map-marked-alt"></i>
            Explorer le Village
        </button>
        
        <div style="margin-top: 40px; color: #666; font-size: 0.9rem;">
            <p>üìú <strong>Rappel :</strong> Tu recevras un message par pigeon voyageur pour confirmer ton inscription.</p>
            <p style="margin-top: 10px;">
                <a href="https://nird.forge.apps.education.fr/" style="color: var(--gaulois-green); font-weight: bold; text-decoration: none;">
                    <i class="fas fa-external-link-alt"></i> Acc√©der √† la plateforme NIRD
                </a>
            </p>
        </div>
    </div>

    <script>
        // Cr√©er des lucioles dynamiques
        function createFireflies() {
            const firefliesContainer = document.getElementById('firefliesContainer');
            for (let i = 0; i < 15; i++) {
                const firefly = document.createElement('div');
                firefly.className = 'firefly';
                firefly.style.left = `${Math.random() * 100}%`;
                firefly.style.top = `${Math.random() * 100}%`;
                firefly.style.animationDelay = `${Math.random() * 8}s`;
                firefliesContainer.appendChild(firefly);
            }
        }
        
        // V√©rification de la correspondance des mots de passe
        const passwordInput = document.getElementById('password');
        const confirmPasswordInput = document.getElementById('confirm_password');
        
        function checkPasswordMatch() {
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;
            
            if (confirmPassword === '') return true;
            
            return password === confirmPassword;
        }
        
        confirmPasswordInput.addEventListener('input', function() {
            if (!checkPasswordMatch()) {
                this.style.borderColor = '#ff4444';
                this.style.boxShadow = '0 0 25px rgba(255, 68, 68, 0.6)';
            } else {
                this.style.borderColor = '#00c851';
                this.style.boxShadow = '0 0 25px rgba(0, 200, 81, 0.6)';
            }
        });
        
        // Gestion de l'inscription
        const signupForm = document.getElementById('gaulishSignupForm');
        const signupPage = document.getElementById('signupPage');
        const successPage = document.getElementById('successPage');
        const resistantNameEl = document.getElementById('resistantName');
        
        signupForm.addEventListener('submit', async function(event) {
            event.preventDefault();
            
            // R√©cup√©rer les valeurs
            const username = document.getElementById('username').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const confirm_password = document.getElementById('confirm_password').value;
            const acceptTerms = document.getElementById('acceptTerms').checked;
            
            // Validation
            let errors = [];
            
            if (!username) errors.push("Le nom de gaulois est requis");
            if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) errors.push("Un message de pigeon valide est requis");
            if (password.length < 8) errors.push("La formule magique doit avoir au moins 8 caract√®res");
            if (!checkPasswordMatch()) errors.push("Les formules magiques ne correspondent pas");
            if (!acceptTerms) errors.push("Tu dois accepter le serment du r√©sistant");
            
            if (errors.length > 0) {
                alert("Erreurs :\n" + errors.join("\n"));
                return;
            }
            
            // Envoyer les donn√©es au serveur
            try {
                const response = await fetch('/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username,
                        email,
                        password,
                        confirm_password
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Afficher la page de succ√®s
                    signupPage.style.display = "none";
                    successPage.style.display = "block";
                    resistantNameEl.textContent = username;
                    
                    // Animation suppl√©mentaire
                    createFireflies();
                    
                    // Redirection vers le dashboard apr√®s 5 secondes
                    setTimeout(() => {
                        window.location.href = data.redirect;
                    }, 5000);
                } else {
                    alert("Erreur d'inscription : " + data.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert("Erreur de connexion au serveur.");
            }
        });
        
        // Initialiser les lucioles
        createFireflies();
    </script>
</body>
</html>